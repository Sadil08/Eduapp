# EduApp PostgreSQL Setup Guide

This guide provides a complete procedure to set up PostgreSQL locally and populate the EduApp database with sample data for testing.

## Prerequisites

- PostgreSQL installed on your system
- Java 17+ (for running the Spring Boot application)
- Maven (for building the project)

## Step 1: Install and Configure PostgreSQL

### On Ubuntu/Debian:
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### On macOS (using Homebrew):
```bash
brew install postgresql
brew services start postgresql
```

### On Windows:
Download and install PostgreSQL from: https://www.postgresql.org/download/windows/

### Create Database and User:
```bash
# Switch to postgres user
sudo -u postgres psql

# In PostgreSQL shell:
CREATE DATABASE eduapp_db;
CREATE USER postgres WITH PASSWORD 'password';
GRANT ALL PRIVILEGES ON DATABASE eduapp_db TO postgres;
\q
```

## Step 2: Update Application Configuration

The `application.yml` has been updated to use PostgreSQL:

```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/eduapp_db
    driver-class-name: org.postgresql.Driver
    username: postgres
    password: password
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate.format_sql: true
```

## Step 3: Run the Application

```bash
# Build the application
mvn clean install

# Run the application
mvn spring-boot:run
```

The JPA with `ddl-auto: update` will automatically create all tables based on your entity classes.

## Step 4: Insert Sample Data

Run the sample data script using psql:

```bash
# Connect to the database
psql -U postgres -d eduapp_db -f scripts/02_sample_data.sql
```

Or copy and paste the contents of `scripts/02_sample_data.sql` into your PostgreSQL client.

## Sample Data Overview

The sample data includes:

### Users:
- **Admin**: email: `admin@eduapp.com`, password: `password`
- **Student**: email: `student@eduapp.com`, password: `password`

### Subjects (4 subjects):
- Mathematics
- Physics
- Chemistry
- Biology

### Lessons (6 lessons across subjects):
- Algebra Fundamentals, Calculus Basics (Math)
- Mechanics, Thermodynamics (Physics)
- Organic Chemistry (Chemistry)
- Cell Biology (Biology)

### Paper Bundles (6 bundles):
- Algebra Practice Set ($9.99)
- Calculus Mock Exam ($14.99)
- Physics Mechanics Bundle ($12.99)
- Thermodynamics Papers ($11.99)
- Organic Chemistry Lab ($13.99)
- Biology Cell Quiz ($8.99)

### Papers (8 papers):
- Various types: MCQ, ESSAY, MIXED
- Questions covering different topics

### Questions & Options:
- 9 questions total
- Multiple choice and essay questions
- Correct answers defined

### Student Data:
- Student has access to Algebra and Biology bundles
- Completed Algebra quiz with 2 correct answers
- In-progress Biology quiz
- Progress tracking for subjects/lessons
- Leaderboard entries
- Cart items
- Notifications
- AI analysis for completed questions

## Testing the Application

### Login Credentials:
- **Admin**: `admin@eduapp.com` / `password`
- **Student**: `student@eduapp.com` / `password`

### API Endpoints to Test:
- `POST /auth/login` - Login
- `GET /subjects` - Get all subjects
- `GET /paper-bundles` - Get all paper bundles
- `GET /papers/{id}` - Get paper details
- `POST /student-paper-attempts` - Start paper attempt
- `GET /progress` - Get student progress
- `GET /leaderboard` - Get leaderboard

## Troubleshooting

### Connection Issues:
- Ensure PostgreSQL is running: `sudo systemctl status postgresql`
- Check if database exists: `psql -U postgres -l`
- Verify connection: `psql -U postgres -d eduapp_db`

### Password Hashing:
The sample data uses BCrypt hashed passwords. If you need to generate new hashes:

```java
// In your Spring Boot application
@Autowired
private PasswordEncoder passwordEncoder;

String hashedPassword = passwordEncoder.encode("yourpassword");
```

### Schema Issues:
If tables are not created, check the console logs for Hibernate errors. You may need to:
1. Drop and recreate the database
2. Ensure all entity classes are properly annotated
3. Check for circular dependencies in relationships

## Database Schema

The schema is automatically generated by JPA. Key tables:
- `users` - User accounts
- `subjects` - Academic subjects
- `lessons` - Lessons within subjects
- `paper_bundles` - Collections of papers
- `papers` - Individual test papers
- `questions` - Questions within papers
- `question_options` - Multiple choice options
- `student_paper_attempts` - Student attempts on papers
- `student_answers` - Individual answers
- `student_bundle_access` - Purchased bundle access
- `progress` - Learning progress tracking
- `leaderboard_entries` - Rankings
- `cart` - Shopping cart items
- `notifications` - User notifications
- `ai_analysis` - AI-generated analysis
- `overall_paper_analysis` - Paper performance analysis

## Notes

- All foreign key relationships are properly maintained
- Sample data provides realistic test scenarios
- Passwords are pre-hashed for convenience
- Timestamps use current time for recent activity
- Student has partial progress and completed activities for testing